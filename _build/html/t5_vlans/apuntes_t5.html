
<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tema 4: Configuración de redes virtuales VLAN &#8212; documentación de Apuntes de redes - 1.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Tema 6:Configuración y administración de protocolos dinámicos" href="../t6_enrutamiento_dinamico/apuntes_t6.html" />
    <link rel="prev" title="Tema 5: Configuración y administración básica de routers" href="../t4_routers/apuntes_t4.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tema-4-configuracion-de-redes-virtuales-vlan">
<h1>Tema 4: Configuración de redes virtuales VLAN<a class="headerlink" href="#tema-4-configuracion-de-redes-virtuales-vlan" title="Enlazar permanentemente con este título"></a></h1>
<section id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Enlazar permanentemente con este título"></a></h2>
<p>Las VLAN intentan dar solución a un problema consistente en que a veces ordenadores de una misma sala no forman parte de la misma red.</p>
<p>Es decir, queremos una red virtual formada por ordenadores que están en sitios distintos. La solución a este problema son las VLANs (Virtual Local Area Network).</p>
</section>
<section id="el-diseno-de-redes-locales-a-tres-capas-nucleo-distribucion-y-acceso">
<h2>El diseño de redes locales a tres capas (núcleo, distribución y acceso).<a class="headerlink" href="#el-diseno-de-redes-locales-a-tres-capas-nucleo-distribucion-y-acceso" title="Enlazar permanentemente con este título"></a></h2>
<p>En general, para diseñar redes grandes se utiliza una topología llamada de tres niveles. Cada nivel va a cumplir funciones distintas del anterior. Estos niveles son núcleo, distribución y acceso.</p>
<ul class="simple">
<li><p>Se llama «switches de acceso» a aquellos switches que dan servicio directo a terminales como PCs, impresoras o similares.</p></li>
<li><p>Se llama «switches de distribución» a <em>switches que interconectan switches de acceso</em>.</p></li>
<li><p>Se llama «switches de núcleo» a <em>switches que interconectan switches de distribución y que están más cerca del punto de salida (router)</em></p></li>
</ul>
<p>En la figura puede verse una organización típica con tres capas.</p>
<figure class="align-default">
<img alt="t5_vlans/02-tres-capas.png" src="t5_vlans/02-tres-capas.png" />
</figure>
</section>
<section id="implantacion-y-configuracion-de-redes-virtuales">
<h2>Implantación y configuración de redes virtuales.<a class="headerlink" href="#implantacion-y-configuracion-de-redes-virtuales" title="Enlazar permanentemente con este título"></a></h2>
<section id="implantacion">
<h3>Implantación<a class="headerlink" href="#implantacion" title="Enlazar permanentemente con este título"></a></h3>
<p>En primer lugar es IMPRESCINDIBLE disponer de hardware que soporte VLANs y a ser posible usando el protocolo estándar 802.1q.</p>
<ol class="arabic simple">
<li><p>Se debe entrar en el switch y crear las distintas VLANs (con un número).</p></li>
<li><p>Se deben asignar puertos del switch a esas VLAN. Estos puertos se denominan «puertos de acceso». Es importante recordar que las VLAN están unidas a los puertos del switch. Si tiramos del cable y se conectar ese cable de ordenador a otro puertos, habremos sacado al ordenador de su VLAN.</p></li>
<li><p>A menudo las VLAN deben pasar por varios switches. Habrá puertos que transporten tráfico de varias VLANs. Estos puertos se denominan «troncos» o «puertos troncales». Se debe avisar al switch de los puertos que actuarán como troncales.</p></li>
</ol>
</section>
<section id="configuracion">
<h3>Configuración<a class="headerlink" href="#configuracion" title="Enlazar permanentemente con este título"></a></h3>
<p>Al crear la arquitectura de redes es <strong>fundamental</strong> que los usuarios no tengan acceso al cableado del switch. Una vez se les asigne una VLAN, dicha VLAN quedará asociada a la interfaz del switch. Si alguien tira del cable del switch y lo conecta a otra interfaz <em>el usuario quedará fuera de la VLAN</em>.</p>
<p>Para configurar dispositivos Cisco se usan comandos como estos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Permiten convertirse en</span>
<span class="c1">#administrador y pasar al modo</span>
<span class="c1">#de configuración global.</span>
<span class="n">enable</span>
<span class="n">configure</span> <span class="n">terminal</span>
</pre></div>
</div>
<p>Para poner una interfaz del switch en modo acceso solo tenemos que hacer cuatro cosas:</p>
<ol class="arabic simple">
<li><p>Entrar en la interfaz correcta (recuérdese que es <strong>fundamental</strong> tomar nota correcta de la interfaz a la que va conectado cada terminal)</p></li>
<li><p>Poner la interfaz en modo acceso.</p></li>
<li><p>Asignar una ID de VLAN a ese interfaz.</p></li>
<li><p>Activar la conexión. En realidad no tiene por qué ser necesario pero debe recordarse que podríamos tener dispositivos en los que las interfaces no se encienden por defecto.</p></li>
</ol>
<p>Así, los comandos necesarios serían estos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Entramos en la interfaz</span>
<span class="n">interface</span> <span class="n">fastethernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="c1">#Activamos el modo acceso</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
<span class="c1">#Indicamos la VLAN</span>
<span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">10</span>
<span class="c1">#Activamos la tarjeta.</span>
<span class="n">no</span> <span class="n">shutdown</span>
<span class="c1">#Salimos de esta tarjeta</span>
<span class="n">exit</span>
<span class="c1">#Entramos en la siguiente</span>
<span class="c1">#y configuramos el resto de</span>
<span class="c1">#interfaces...</span>
<span class="n">interface</span> <span class="n">fastethernet</span> <span class="o">..</span>
</pre></div>
</div>
</section>
</section>
<section id="definicion-de-enlaces-troncales-en-los-conmutadores-y-routers">
<h2>Definición de enlaces troncales en los conmutadores y routers.<a class="headerlink" href="#definicion-de-enlaces-troncales-en-los-conmutadores-y-routers" title="Enlazar permanentemente con este título"></a></h2>
<p>Para configurar el acceso troncal, el proceso es parecido.</p>
<ol class="arabic simple">
<li><p>Entrar en la tarjeta</p></li>
<li><p>Activar el modo «trunk».</p></li>
<li><p>Indicar las VLANs que se autorizan</p></li>
<li><p>Encender la tarjeta</p></li>
<li><p>Hacer lo mismo en los dos lados del cable.</p></li>
</ol>
<p>Los comandos serían:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Para entrar en la tarjeta</span>
<span class="n">interface</span> <span class="n">fastethernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="c1">#Activar el modo troncal</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
<span class="c1">#Autorizamos la 10 y la 20</span>
<span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="mi">10</span><span class="p">,</span><span class="mi">20</span>

<span class="c1">#Activamos la conexión</span>
<span class="n">no</span> <span class="n">shutdown</span>
</pre></div>
</div>
<p>En algunos dispositivos se pueden configurar muchas interfaces a la vez, haciendo esto:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">fastethernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="o">-</span><span class="mi">12</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
<span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">30</span>
<span class="n">no</span> <span class="n">shutdown</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Al construir VLANs y enlaces troncales se debe tener cuidado al «copiar y pegar configuraciones» de unos switches a otros. Podría ocurrir que sin querer autorizásemos VLANs en enlaces troncales que no debían permitir ese paso.</p>
</div>
<section id="reflexion-sobre-ciclos-en-switches-con-vlans">
<h3>Reflexión sobre ciclos en switches con VLANs<a class="headerlink" href="#reflexion-sobre-ciclos-en-switches-con-vlans" title="Enlazar permanentemente con este título"></a></h3>
<p>Observa la figura siguiente</p>
<figure class="align-default">
<img alt="t5_vlans/03-stp-ciclos.png" src="t5_vlans/03-stp-ciclos.png" />
</figure>
<p>¿Por qué no se han deshabilitado puertos? En realidad sí se deshabilitan, pero cuando tenemos ciclos en switches que forman parte de VLANs puede ocurrir que <strong>un puerto esté bloqueado dentro de una VLAN, pero esté activo dentro de otra VLAN distinta</strong>. En realidad lo que ejecutan los switches modernos es PVST (Per-VLAN Spanning Tree)</p>
</section>
</section>
<section id="protocolos-para-la-administracion-centralizada-de-redes-virtuales-el-protocolo-vtp">
<h2>Protocolos para la administración centralizada de redes virtuales; el protocolo VTP<a class="headerlink" href="#protocolos-para-la-administracion-centralizada-de-redes-virtuales-el-protocolo-vtp" title="Enlazar permanentemente con este título"></a></h2>
<p>En realidad <strong>las VLAN no se crean «sobre la marcha» a medida que definimos los interfaces</strong>. En redes grandes se establecen muy claramente dos cosas:</p>
<ul class="simple">
<li><p>El identificador de VLAN al que van a pertenecer un grupo de usuarios.</p></li>
<li><p>El <em>nombre de dicha VLAN</em>. Aunque los nombres no son estrictamente obligatorios <strong>sí son muy recomendables</strong>. En redes grandes pueden ser fundamentales para no perdernos en la asignación de interfaces a VLANs.</p></li>
</ul>
<p>Este último punto es el que nos interesa. Para crear una VLAN y asociarle un nombre tenemos que dar estos pasos:</p>
<p>¿Qué ocurre si tenemos una red grande con varias decenas de VLANs? ¿Y si además de vez en cuando algunos nombres cambian o se crean otros nuevos? Evidentemente, conectarse a tantos switches tecleando una y otra vez los mismos comandos y/o cambiar los números o nombres correspondientes no solo es muy tedioso, sino propenso a errores. Para evitar esto tenemos un protocolo llamado VTP (VLAN Trunking Protocol) que nos va a facilitar la operativa.</p>
<section id="modos-vtp">
<h3>Modos VTP<a class="headerlink" href="#modos-vtp" title="Enlazar permanentemente con este título"></a></h3>
<ol class="arabic simple">
<li><p>Servidor.</p></li>
<li><p>Cliente.</p></li>
<li><p>Transparente</p></li>
</ol>
</section>
<section id="proceso-basico">
<h3>Proceso básico<a class="headerlink" href="#proceso-basico" title="Enlazar permanentemente con este título"></a></h3>
<p>En el modo de configuración global tenemos que hacer esto:</p>
<ol class="arabic simple">
<li><p>Configurar dominio con el comando <code class="docutils literal notranslate"><span class="pre">vtp</span> <span class="pre">domain</span> <span class="pre">acme.com</span></code>.</p></li>
<li><p>Configurar la clave con <code class="docutils literal notranslate"><span class="pre">vtp</span> <span class="pre">password</span> <span class="pre">abcd1234</span></code>.</p></li>
<li><p>Configurar el modo con <code class="docutils literal notranslate"><span class="pre">vtp</span> <span class="pre">mode</span> <span class="pre">client</span></code> o <code class="docutils literal notranslate"><span class="pre">vtp</span> <span class="pre">mode</span> <span class="pre">server</span></code></p></li>
<li><p>Habilitar los interfaces troncales correspondientes.</p></li>
</ol>
</section>
</section>
<section id="el-protocolo-ieee802-1q">
<h2>El protocolo IEEE802.1Q<a class="headerlink" href="#el-protocolo-ieee802-1q" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="diagnostico-de-incidencias-en-redes-virtuales">
<h2>Diagnóstico de incidencias en redes virtuales.<a class="headerlink" href="#diagnostico-de-incidencias-en-redes-virtuales" title="Enlazar permanentemente con este título"></a></h2>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Apuntes de redes</a></h1>








<h3>Navegación</h3>
<p class="caption" role="heading"><span class="caption-text">Índice:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../t1_caracterizacion_redes/apuntes_t1.html">Tema 1:Caracterización de redes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/apuntes_t2.html">Tema 2:Integración de elementos en una red</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t3_conmutadores/apuntes_t3.html">Tema 3:Configuración y administración de conmutadores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t4_routers/apuntes_t4.html">Tema 5: Configuración y administración básica de routers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tema 4: Configuración de redes virtuales VLAN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduccion">Introducción</a></li>
<li class="toctree-l2"><a class="reference internal" href="#el-diseno-de-redes-locales-a-tres-capas-nucleo-distribucion-y-acceso">El diseño de redes locales a tres capas (núcleo, distribución y acceso).</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implantacion-y-configuracion-de-redes-virtuales">Implantación y configuración de redes virtuales.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implantacion">Implantación</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuracion">Configuración</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#definicion-de-enlaces-troncales-en-los-conmutadores-y-routers">Definición de enlaces troncales en los conmutadores y routers.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reflexion-sobre-ciclos-en-switches-con-vlans">Reflexión sobre ciclos en switches con VLANs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#protocolos-para-la-administracion-centralizada-de-redes-virtuales-el-protocolo-vtp">Protocolos para la administración centralizada de redes virtuales; el protocolo VTP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modos-vtp">Modos VTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proceso-basico">Proceso básico</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#el-protocolo-ieee802-1q">El protocolo IEEE802.1Q</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diagnostico-de-incidencias-en-redes-virtuales">Diagnóstico de incidencias en redes virtuales.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../t6_enrutamiento_dinamico/apuntes_t6.html">Tema 6:Configuración y administración de protocolos dinámicos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t7_acceso_internet/apuntes_t7.html">Tema 7: Configuración del acceso a Internet desde una LAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anexos/t1_ejercicios.html">Anexo: Ejercicios propuestos para el tema 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_switches/ejercicios_dos_switches.html">Anexo: ejercicios con tablas MAC de switches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_subredes_ipv4/rangos_direcciones.html">Anexo: ejercicios sobre rangos de direcciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_subredes/ejercicios_calculo_subredes.html">Anexo: cálculo de subredes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_subredes_ipv4/ejercicios_dos_router.html">Anexo: ejercicios de enrutamiento</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_subredes_ipv4/ejercicios_3_router_caso_a.html">Anexo: ejercicios de enrutamiento con 3 routers (caso 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejerciciosipv6/ejercicios_ipv6.html">Anexo: Ejercicios sobre compresión de direcciones IPv6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejerciciosipv6/ejercicios_ipv6.html#soluciones-a-compresion-de-direcciones-ipv6">Soluciones a compresión de direcciones IPv6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_ips/clasificacion_ipv6.html">Anexo: ejercicios sobre clasificación de direcciones IPv6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t2_integracion_elementos/ejercicios_ips/clasificacion_ipv6.html#soluciones-a-la-clasificaciones-de-direcciones-ipv6">Soluciones a la clasificaciones de direcciones IPv6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t3_conmutadores/ejercicios/ejercicios_switches.html">Anexo al tema 3: Ejercicios sobre comandos Cisco en switches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t3_conmutadores/simuladorstp/stp1.html">Anexo al tema 3:Ejercicios STP</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../t4_routers/apuntes_t4.html" title="capítulo anterior">Tema 5: Configuración y administración básica de routers</a></li>
      <li>Next: <a href="../t6_enrutamiento_dinamico/apuntes_t6.html" title="próximo capítulo">Tema 6:Configuración y administración de protocolos dinámicos</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Oscar G. G..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/t5_vlans/apuntes_t5.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>